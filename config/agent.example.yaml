# Metrics Collection Agent Configuration

agent:
  # Hostname (set to 'auto' for automatic detection)
  hostname: "auto"

  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_level: "INFO"

  # Log file path (set to null for stdout only)
  log_file: null

  # Log format: text or json
  log_format: "text"

prometheus:
  # Prometheus HTTP server port
  port: 9100

  # Bind address (0.0.0.0 for all interfaces)
  host: "0.0.0.0"

collectors:
  # CPU metrics collector
  cpu:
    enabled: true
    interval: 5  # Collection interval in seconds
    per_cpu: true  # Collect per-core metrics

  # Memory metrics collector
  memory:
    enabled: true
    interval: 5

  # Disk metrics collector
  disk:
    enabled: true
    usage_interval: 30  # Disk usage collection interval
    io_interval: 5  # Disk I/O collection interval
    exclude_filesystems:
      - tmpfs
      - devtmpfs
      - squashfs
    exclude_mount_points:
      - /snap

  # Network metrics collector
  network:
    enabled: true
    interval: 5
    exclude_interfaces:
      - lo  # Exclude loopback
    collect_connections: true  # Collect connection states

  # Process metrics collector
  process:
    enabled: true
    interval: 10
    top_n: 20  # Number of top processes to track
    include_threads: false

resource_limits:
  # Agent's own resource usage limits
  max_cpu_percent: 2.0  # Maximum CPU usage
  max_memory_mb: 50  # Maximum memory usage in MB
  check_interval: 60  # Check interval in seconds
  action_on_exceed: "log"  # Action: log, disable_collectors, or stop

# Alerting configuration
alerting:
  # Enable/disable alerting system
  enabled: false

  # Alert evaluation interval in seconds
  evaluation_interval: 30

  # Path to alert rules file
  alert_rules_file: "config/alerts.example.yaml"

  # Send notifications when alerts are resolved
  send_resolved_notifications: false

  # Notification channels
  channels:
    # Email notifications via SMTP
    email:
      enabled: false
      smtp_host: "smtp.gmail.com"
      smtp_port: 587
      smtp_user: "alerts@example.com"
      smtp_password: ""  # Use environment variable EMAIL_PASSWORD
      use_tls: true
      from_address: "alerts@example.com"
      to_addresses:
        - "admin@example.com"

    # Slack notifications via webhook
    slack:
      enabled: false
      webhook_url: ""  # Use environment variable SLACK_WEBHOOK_URL
      channel: "#alerts"
      username: "Metrics Agent"
      icon_emoji: ":rotating_light:"

    # Custom webhook notifications
    webhook:
      enabled: false
      url: "https://your-webhook-endpoint.example.com/alerts"
      method: "POST"
      headers: {}
      timeout: 10

  # Alert storage configuration
  storage:
    type: "sqlite"
    sqlite_path: "./data/alerts.db"
    retention_days: 30  # Keep alert history for 30 days
